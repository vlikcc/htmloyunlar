<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Güneş Sistemi Sıralama | Eğitici Oyun</title>
  <meta name="description" content="Gezegenleri Güneş'e olan uzaklığa göre sırala. Fen Bilgisi oyunu.">
  <meta name="theme-color" content="#0a2a6b">
  <style>
    :root {
      /* Renk paleti */
      --color-bg: #061a3a;
      --color-bg-2: #0a2a6b;
      --color-surface: #0f357f;
      --color-accent: #ffcc00;
      --color-ok: #33d17a;
      --color-bad: #ff5c5c;
      --color-text: #eaf2ff;
      --color-muted: #a9b9dd;
      --slot: #123c8f;

      /* Boyutlar */
      --pad: 1.2rem;
      --radius: 0.8rem;
      --btn: 3.2rem; /* 44px ~ 2.75rem; güvenli 3.2rem */
    }

    /* Reset ve temel */
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    html { font-size: 16px; }
    @media (max-width: 360px) { html { font-size: 15px; } }
    @media (min-width: 1280px) { html { font-size: 18px; } }
    body {
      margin: 0;
      background: radial-gradient(120vw 120vh at 20% 10%, #0b2d75, var(--color-bg));
      color: var(--color-text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell,
        Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      line-height: 1.35;
      overflow: hidden; /* Kaydırma YOK */
    }

    /* Uygulama konteyneri */
    .app {
      width: 100vw;
      height: 100vh;
      display: grid;
      grid-template-rows: auto 1fr auto;
      grid-template-columns: 1fr;
    }

    header {
      display: grid;
      grid-template-columns: 1fr auto auto auto auto;
      gap: 0.6rem;
      align-items: center;
      padding: var(--pad);
      background: linear-gradient(180deg, rgba(10,42,107,0.9), rgba(6,26,58,0.7));
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      min-width: 0;
    }
    .brand svg { flex: 0 0 auto; }
    .brand h1 {
      font-size: 1.1rem;
      margin: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    button, select {
      appearance: none;
      border: none;
      outline: none;
      cursor: pointer;
      background: var(--color-surface);
      color: var(--color-text);
      padding: 0 0.9rem;
      height: var(--btn);
      border-radius: var(--radius);
      font-size: 1rem;
      transition: transform 120ms ease, background 160ms ease, box-shadow 160ms ease;
      box-shadow: 0 4px 10px rgba(0,0,0,0.25) inset, 0 2px 10px rgba(0,0,0,0.2);
    }
    button:hover, select:hover { background: #1342a2; }
    button:active { transform: translateY(1px) scale(0.99); }
    button[disabled] { opacity: 0.6; cursor: not-allowed; }

    .btn-accent { background: linear-gradient(180deg, #ffd64d, var(--color-accent)); color: #2a2500; }
    .btn-ok { background: linear-gradient(180deg, #46e08b, var(--color-ok)); color: #072215; }
    .btn-bad { background: linear-gradient(180deg, #ff8383, var(--color-bad)); color: #330000; }

    main {
      display: grid;
      grid-template-columns: 1fr 1.2fr;
      gap: 1rem;
      padding: var(--pad);
      min-height: 0;
    }
    @media (max-width: 960px) {
      main { grid-template-columns: 1fr; grid-template-rows: 1fr 1fr; }
    }

    .panel {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: var(--radius);
      padding: var(--pad);
      min-height: 0;
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 0.6rem;
    }
    .stat {
      background: rgba(0,0,0,0.25);
      border-radius: 0.6rem;
      padding: 0.5rem 0.6rem;
      text-align: center;
      font-size: 0.95rem;
    }
    .progress {
      width: 100%; height: 0.6rem; background: rgba(255,255,255,0.15);
      border-radius: 999px; overflow: hidden;
    }
    .progress > span { display: block; height: 100%; width: 0%; background: var(--color-accent); transition: width 200ms ease; }

    .pool, .board {
      flex: 1;
      min-height: 0;
      position: relative;
      overflow: hidden;
      border-radius: calc(var(--radius) - 0.2rem);
      background: rgba(0,0,0,0.2);
    }

    .pool-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(8rem, 1fr));
      gap: 0.6rem;
      padding: 0.6rem;
    }

    .planet {
      touch-action: none; /* pointer-events için */
      user-select: none;
      -webkit-user-drag: none;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 0.8rem;
      padding: 0.5rem;
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 0.6rem;
      min-height: 4.2rem;
      will-change: transform;
      transition: box-shadow 160ms ease, background 160ms ease, transform 120ms ease;
    }
    .planet:active { transform: scale(0.98); }
    .planet .svg { width: 2.6rem; height: 2.6rem; }
    .planet .name { font-weight: 700; letter-spacing: 0.2px; }
    .planet .info { background: #143b93; height: 2.2rem; padding: 0 0.6rem; }

    .board-inner {
      position: absolute;
      inset: 0;
      display: grid;
      grid-template-rows: auto 1fr auto;
    }

    .sun-row {
      display: flex; align-items: center; justify-content: center; gap: 0.6rem;
      padding: 0.4rem 0.6rem;
    }
    .sun {
      width: 3.4rem; height: 3.4rem; border-radius: 999px;
      background: radial-gradient(circle at 35% 35%, #fff6b3, #ffcc00 50%, #e09b00 70%, #cc7a00);
      box-shadow: 0 0 40px 10px rgba(255,204,0,0.4);
      border: 2px solid rgba(255,255,255,0.5);
    }

    .slots {
      position: relative; margin: 0.6rem; border-radius: 0.8rem; flex: 1;
      background: linear-gradient(180deg, rgba(15,53,127,0.7), rgba(10,42,107,0.9));
      border: 1px dashed rgba(255,255,255,0.2);
      display: grid; grid-template-rows: repeat(8, 1fr); gap: 0.4rem; padding: 0.4rem;
    }
    .slot {
      position: relative; border-radius: 0.6rem; background: var(--slot);
      outline: 2px dashed rgba(255,255,255,0.14);
      display: grid; grid-template-columns: 2.8rem 1fr 3rem; gap: 0.6rem; align-items: center;
      padding: 0.4rem 0.6rem; min-height: 3.2rem;
      transition: transform 160ms ease, background 160ms ease, outline-color 160ms ease;
    }
    .slot .idx {
      background: rgba(0,0,0,0.25); width: 2.2rem; height: 2.2rem; border-radius: 999px;
      display: grid; place-items: center; font-weight: 700; color: var(--color-muted);
    }
    .slot .hint { color: var(--color-muted); font-size: 0.9rem; }
    .slot.accept { outline-color: var(--color-accent); transform: scale(1.01); }
    .slot.filled { background: rgba(18,60,143,0.65); }
    .slot.correct { outline: 2px solid var(--color-ok); }
    .slot.wrong { outline: 2px solid var(--color-bad); }

    .board-footer {
      display: flex; align-items: center; justify-content: space-between; gap: 0.6rem;
      padding: 0.4rem 0.6rem 0.6rem;
    }

    .footer-actions { display: flex; gap: 0.4rem; flex-wrap: wrap; }

    /* Modal */
    .modal-backdrop {
      position: fixed; inset: 0; background: rgba(0,0,0,0.55);
      display: none; align-items: center; justify-content: center; padding: 1rem;
    }
    .modal { background: #0b2b70; border: 1px solid rgba(255,255,255,0.18); border-radius: 1rem;
      max-width: 34rem; width: 100%; padding: 1rem; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
    .modal h3 { margin-top: 0; }
    .modal-backdrop.show { display: flex; }

    /* Toast / geri bildirim */
    .toast { position: fixed; left: 50%; bottom: 1rem; transform: translateX(-50%);
      background: rgba(0,0,0,0.7); color: #fff; padding: 0.6rem 0.9rem; border-radius: 0.6rem;
      opacity: 0; transition: opacity 160ms ease, transform 160ms ease; pointer-events: none; }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(-4px); }

    /* Yükleme */
    .splash { position: fixed; inset: 0; display: grid; place-items: center; background: var(--color-bg);
      z-index: 999; transition: opacity 240ms ease, visibility 0s linear 240ms; }
    .splash.hide { opacity: 0; visibility: hidden; }

    /* Erişilebilir odak */
    :focus-visible { outline: 3px solid var(--color-accent); outline-offset: 2px; }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Güneş Sistemi Sıralama Oyunu">
    <header>
      <div class="brand" aria-label="Oyun Başlığı">
        <svg width="32" height="32" viewBox="0 0 64 64" aria-hidden="true">
          <defs>
            <radialGradient id="g" cx="0.35" cy="0.35" r="0.8">
              <stop offset="0%" stop-color="#fff6b3"/>
              <stop offset="50%" stop-color="#ffcc00"/>
              <stop offset="80%" stop-color="#e09b00"/>
              <stop offset="100%" stop-color="#cc7a00"/>
            </radialGradient>
          </defs>
          <circle cx="22" cy="22" r="14" fill="url(#g)"/>
          <circle cx="48" cy="40" r="6" fill="#9ec9ff"/>
          <circle cx="12" cy="46" r="4" fill="#66e0a3"/>
        </svg>
        <h1>Güneş Sistemi Sıralama</h1>
      </div>
      <div class="controls" role="group" aria-label="Oyun Kontrolleri">
        <label for="level" class="sr" aria-hidden="true" style="position:absolute;left:-9999px;">Seviye</label>
        <select id="level" title="Seviye Seç" aria-label="Seviye Seç">
          <option value="easy">Kolay</option>
          <option value="medium">Orta</option>
          <option value="hard">Zor</option>
        </select>
        <button id="btn-sound" aria-pressed="false" title="Sesi Aç/Kapat">🔊 Ses</button>
        <button id="btn-pause" title="Durdur / Devam">⏸️ Duraklat</button>
        <button id="btn-restart" class="btn-bad" title="Yeniden Başlat">↻</button>
        <button id="btn-full" class="btn-accent" title="Tam Ekran">⛶</button>
      </div>
    </header>

    <main>
      <section class="panel" aria-label="Gezegen Havuzu">
        <div class="stats" aria-live="polite">
          <div class="stat">Puan: <strong id="score">0</strong></div>
          <div class="stat">Süre: <strong id="time">00:00</strong></div>
          <div class="stat">Hamle: <strong id="moves">0</strong></div>
          <div class="stat">En İyi: <strong id="best">0</strong></div>
        </div>
        <div class="progress" aria-label="İlerleme">
          <span id="progress-bar"></span>
        </div>
        <div class="pool" id="pool" aria-label="Sürüklenebilir Gezegenler">
          <div class="pool-list" id="poolList"></div>
        </div>
      </section>

      <section class="panel" aria-label="Sıralama Tahtası">
        <div class="board">
          <div class="board-inner">
            <div class="sun-row">
              <div class="sun" role="img" aria-label="Güneş"></div>
              <span style="color:var(--color-muted)">Güneş'e Yakından Uzağa</span>
            </div>
            <div class="slots" id="slots" aria-label="Sıralama Alanı">
              <!-- 8 slot -->
            </div>
            <div class="board-footer">
              <div class="footer-actions">
                <button id="btn-check" class="btn-ok">Kontrol Et</button>
                <button id="btn-hint">İpucu</button>
              </div>
              <div class="footer-info" id="footerInfo" aria-live="polite"></div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer style="padding:0.6rem var(--pad); color:var(--color-muted); text-align:center;">
      Fen Bilgisi | Gezegenleri Güneş'e olan uzaklığa göre sırala. Öğren, eğlen, keşfet!
    </footer>
  </div>

  <!-- Modal -->
  <div class="modal-backdrop" id="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-hidden="true">
    <div class="modal">
      <h3 id="modalTitle">Gezegen Bilgisi</h3>
      <div id="modalBody"></div>
      <div style="display:flex; gap:0.4rem; justify-content:flex-end; margin-top:0.8rem;">
        <button id="modalClose" class="btn-accent">Kapat</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>
  <div class="splash" id="splash"><div>
    <div class="sun" aria-hidden="true" style="margin:0 auto"></div>
    <div style="margin-top:0.8rem;color:var(--color-muted);text-align:center;">Yükleniyor…</div>
  </div></div>

  <script>
    'use strict';
    // Türkçe değişken ve fonksiyon isimleri tercih edildi.

    // LocalStorage yardımcıları
    const storage = {
      get(key, fallback) {
        try { const v = localStorage.getItem(key); return v ? JSON.parse(v) : fallback; }
        catch { return fallback; }
      },
      set(key, value) {
        try { localStorage.setItem(key, JSON.stringify(value)); }
        catch {}
      }
    };

    // Ses yöneticisi (Web Audio API)
    class Ses {
      constructor() {
        this.ctx = null;
        this.enabled = storage.get('solar:sound', true);
      }
      ensure() {
        if (!this.ctx) {
          try { this.ctx = new (window.AudioContext || window.webkitAudioContext)(); }
          catch { this.ctx = null; }
        }
      }
      bip(type = 'ok', dur = 0.08, vol = 0.2) {
        if (!this.enabled) return;
        this.ensure(); if (!this.ctx) return;
        const ctx = this.ctx;
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        const now = ctx.currentTime;
        const freq = type === 'ok' ? 880 : type === 'bad' ? 220 : 440;
        o.frequency.value = freq;
        o.type = type === 'ok' ? 'triangle' : 'sawtooth';
        g.gain.setValueAtTime(0, now);
        g.gain.linearRampToValueAtTime(vol, now + 0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, now + dur);
        o.connect(g).connect(ctx.destination);
        o.start(now); o.stop(now + dur + 0.02);
      }
      toggle() { this.enabled = !this.enabled; storage.set('solar:sound', this.enabled); }
    }

    // Oyun verisi: Gezegenler (yakından uzağa doğru sıralı)
    const GEZEGENLER = [
      { id: 'merkur', ad: 'Merkür', renk: '#c7c7c7', bilgi: 'Güneşe en yakın, en küçük gezegen.' },
      { id: 'venus', ad: 'Venüs', renk: '#e0b36b', bilgi: 'Yoğun atmosferi ile çok sıcaktır.' },
      { id: 'dunya', ad: 'Dünya', renk: '#6bc1e0', bilgi: 'Yaşamın bilindiği tek gezegen.' },
      { id: 'mars', ad: 'Mars', renk: '#e27a5f', bilgi: 'Kızıl gezegen, ince atmosfere sahip.' },
      { id: 'jupiter', ad: 'Jüpiter', renk: '#d2b48c', bilgi: 'En büyük gezegen, gaz devidir.' },
      { id: 'saturn', ad: 'Satürn', renk: '#e4d3a2', bilgi: 'Belirgin halkalara sahip gaz devi.' },
      { id: 'uranus', ad: 'Uranüs', renk: '#9bd3e3', bilgi: 'Metan nedeniyle mavi-yeşil görünür.' },
      { id: 'neptun', ad: 'Neptün', renk: '#5aa7e8', bilgi: 'Güneşe en uzak gaz devi.' }
    ];

    // Basit gezegen SVG üreteci
    function gezegenSVG(renk) {
      const r = 28;
      return `<svg class="svg" viewBox="0 0 64 64" aria-hidden="true">
        <defs>
          <radialGradient id="pg" cx="0.35" cy="0.35" r="0.8">
            <stop offset="0%" stop-color="#ffffff" stop-opacity="0.8"/>
            <stop offset="60%" stop-color="${renk}"/>
            <stop offset="100%" stop-color="#000000" stop-opacity="0.2"/>
          </radialGradient>
        </defs>
        <circle cx="32" cy="32" r="${r}" fill="url(#pg)"/>
      </svg>`;
    }

    // Yardımcılar
    const $ = (s, el = document) => el.querySelector(s);
    const $$ = (s, el = document) => Array.from(el.querySelectorAll(s));

    function formatSure(saniye) {
      const m = Math.floor(saniye / 60).toString().padStart(2, '0');
      const s = Math.floor(saniye % 60).toString().padStart(2, '0');
      return `${m}:${s}`;
    }

    function karistir(dizi) {
      const a = dizi.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    // Oyun durumu
    const durum = {
      seviye: storage.get('solar:seviye', 'easy'),
      skor: 0,
      enIyi: storage.get('solar:best', { easy: 0, medium: 0, hard: 0 }),
      hamle: 0,
      sure: 0,
      calisiyor: true,
      baslamaZamani: 0,
      yerlestirme: {}, // slotIndex -> gezegenId
      ses: new Ses(),
      combo: 0
    };

    // Zamanlayıcı
    let rafId = 0;
    function zamanDongusu() {
      if (durum.calisiyor) {
        const simdi = performance.now();
        durum.sure = Math.max(0, Math.floor((simdi - durum.baslamaZamani) / 1000));
        $('#time').textContent = formatSure(durum.sure);
      }
      rafId = requestAnimationFrame(zamanDongusu);
    }

    // UI kurulum
    function olusturSlotlar() {
      const s = $('#slots'); s.innerHTML = '';
      for (let i = 0; i < 8; i++) {
        const d = document.createElement('div');
        d.className = 'slot';
        d.dataset.index = String(i);
        d.innerHTML = `<div class="idx">${i+1}</div><div class="hint">Yerleştir</div><div class="space"></div>`;
        s.appendChild(d);
      }
    }

    function olusturHavuz(gezegenler) {
      const list = $('#poolList'); list.innerHTML = '';
      for (const g of gezegenler) {
        const el = document.createElement('div');
        el.className = 'planet';
        el.setAttribute('role', 'button');
        el.setAttribute('aria-grabbed', 'false');
        el.tabIndex = 0;
        el.dataset.id = g.id;
        el.innerHTML = `${gezegenSVG(g.renk)}<div class="name">${g.ad}</div>
          <button class="info" title="Bilgi">i</button>`;
        list.appendChild(el);
      }
    }

    function guncelleIlerleme() {
      const yerlesmis = Object.keys(durum.yerlestirme).length;
      const yuzde = Math.floor((yerlesmis / 8) * 100);
      $('#progress-bar').style.width = yuzde + '%';
    }

    function guncelleSkor(delta = 0) {
      durum.skor = Math.max(0, durum.skor + delta);
      $('#score').textContent = String(durum.skor);
    }

    function guncelleHamle() {
      $('#moves').textContent = String(durum.hamle);
    }

    function guncelleEnIyi() {
      $('#best').textContent = String(durum.enIyi[durum.seviye] || 0);
    }

    // Toast
    let toastTm = 0;
    function toast(msj) {
      const t = $('#toast');
      t.textContent = msj;
      t.classList.add('show');
      clearTimeout(toastTm);
      toastTm = setTimeout(() => t.classList.remove('show'), 1200);
    }

    // Modal
    function modalAc(baslik, icerikHtml) {
      $('#modalTitle').textContent = baslik;
      $('#modalBody').innerHTML = icerikHtml;
      const m = $('#modal');
      m.classList.add('show');
      m.setAttribute('aria-hidden', 'false');
    }
    function modalKapat() {
      const m = $('#modal');
      m.classList.remove('show');
      m.setAttribute('aria-hidden', 'true');
    }

    // Seviye etkileri
    function seviyeAyarla(seviye) {
      durum.seviye = seviye;
      storage.set('solar:seviye', seviye);
      let gezegenler = GEZEGENLER.slice();
      if (seviye === 'easy') {
        // 8 gezegen, slot ipuçlarını göster
      } else if (seviye === 'medium') {
        // ipuçları azaltılabilir
      } else if (seviye === 'hard') {
        // zor: zaman baskısı ve ipucu sınırlı
      }
      // Havuzu karıştır
      gezegenler = karistir(gezegenler);
      olusturHavuz(gezegenler);
      olusturSlotlar();
      durum.yerlestirme = {};
      guncelleIlerleme();
      guncelleEnIyi();
      $('#footerInfo').textContent = '';
      etkinlestirEtkinlikler();
    }

    // Drag & Drop: Pointer Events tabanlı
    function etkinlestirEtkinlikler() {
      // Bilgi butonları
      $('#poolList').addEventListener('click', (e) => {
        const btn = e.target.closest('.info');
        if (!btn) return;
        const planet = btn.closest('.planet');
        const id = planet.dataset.id;
        const g = GEZEGENLER.find(x => x.id === id);
        if (g) {
          modalAc(g.ad, `<p>${g.bilgi}</p>`);
        }
      });

      // Klavye ile taşıma (erişilebilirlik - basit)
      $('#poolList').addEventListener('keydown', (e) => {
        const p = e.target.closest('.planet');
        if (!p) return;
        if (e.key === 'Enter' || e.key === ' ') {
          // En yakın boş slota yerleştir
          const slot = $('.slot:not(.filled)');
          if (slot) yerlestir(p, slot);
          e.preventDefault();
        }
      });

      // Pointer tabanlı sürükleme
      const pool = $('#poolList');
      let aktif = null;
      let ofsX = 0, ofsY = 0;
      let orjParent = null, orjNext = null;

      function onDown(ev) {
        const el = ev.target.closest('.planet');
        if (!el) return;
        ev.preventDefault();
        aktif = el;
        orjParent = el.parentElement; orjNext = el.nextElementSibling;
        const r = el.getBoundingClientRect();
        ofsX = ev.clientX - r.left; ofsY = ev.clientY - r.top;
        el.style.position = 'fixed';
        el.style.left = (ev.clientX - ofsX) + 'px';
        el.style.top = (ev.clientY - ofsY) + 'px';
        el.style.width = r.width + 'px';
        el.style.zIndex = 1000;
        document.body.appendChild(el);
        el.setAttribute('aria-grabbed', 'true');
        gosterKabul(ev.clientX, ev.clientY);
      }

      function onMove(ev) {
        if (!aktif) return;
        ev.preventDefault();
        aktif.style.left = (ev.clientX - ofsX) + 'px';
        aktif.style.top = (ev.clientY - ofsY) + 'px';
        gosterKabul(ev.clientX, ev.clientY);
      }

      function onUp(ev) {
        if (!aktif) return;
        ev.preventDefault();
        const hedef = slotAltinda(ev.clientX, ev.clientY);
        temizleKabul();
        if (hedef) {
          yerlestir(aktif, hedef);
        } else {
          // geri bırak
          if (orjNext) orjParent.insertBefore(aktif, orjNext); else orjParent.appendChild(aktif);
          aktif.style.position = '';
          aktif.style.left = aktif.style.top = aktif.style.width = aktif.style.zIndex = '';
          aktif.setAttribute('aria-grabbed', 'false');
        }
        aktif = null;
      }

      function slotAltinda(x, y) {
        const el = document.elementFromPoint(x, y);
        const slot = el && el.closest ? el.closest('.slot') : null;
        return slot || null;
      }

      function gosterKabul(x, y) {
        temizleKabul();
        const s = slotAltinda(x, y);
        if (s) s.classList.add('accept');
      }
      function temizleKabul() { $$('.slot.accept').forEach(s => s.classList.remove('accept')); }

      pool.addEventListener('pointerdown', onDown);
      window.addEventListener('pointermove', onMove);
      window.addEventListener('pointerup', onUp);

      // Slota tıklayarak da yerleştirme (mobil kolaylığı)
      $('#slots').addEventListener('click', (e) => {
        const slot = e.target.closest('.slot'); if (!slot) return;
        const ilk = $('#poolList .planet'); if (ilk) yerlestir(ilk, slot);
      });
    }

    function yerlestir(planetEl, slotEl) {
      const slotIndex = Number(slotEl.dataset.index);
      // Önceden dolu ise mevcut elementi geri havuza al
      const mevcut = slotEl.querySelector('.planet');
      if (mevcut) {
        $('#poolList').appendChild(mevcut);
        mevcut.classList.remove('in-slot');
      }
      // Elementi slota koy
      slotEl.classList.add('filled');
      planetEl.classList.add('in-slot');
      planetEl.style.position = '';
      planetEl.style.left = planetEl.style.top = planetEl.style.width = planetEl.style.zIndex = '';
      slotEl.appendChild(planetEl);

      const id = planetEl.dataset.id;
      durum.yerlestirme[slotIndex] = id;
      durum.hamle += 1; guncelleHamle();
      guncelleIlerleme();

      // Doğruluk kontrolü anlık (combo için)
      const dogruId = GEZEGENLER[slotIndex].id;
      if (id === dogruId) {
        durum.combo += 1;
        const bonus = 10 + Math.min(30, durum.combo * 2);
        guncelleSkor(bonus);
        slotEl.classList.remove('wrong'); slotEl.classList.add('correct');
        durum.ses.bip('ok');
        toast('Doğru yerleştirme! +' + bonus);
      } else {
        durum.combo = 0;
        guncelleSkor(-5);
        slotEl.classList.remove('correct'); slotEl.classList.add('wrong');
        durum.ses.bip('bad');
        toast('Yanlış slot, -5');
      }

      // Hepsi yerleşti mi?
      if (Object.keys(durum.yerlestirme).length === 8) {
        kontrolEt(true);
      }
    }

    function kontrolEt(otomatik = false) {
      let dogru = 0;
      for (let i = 0; i < 8; i++) {
        const id = durum.yerlestirme[i];
        if (id && id === GEZEGENLER[i].id) dogru++;
      }
      const hepsi = dogru === 8;
      $('#footerInfo').textContent = hepsi ? 'Harika! Tümü doğru.' : `${dogru}/8 doğru.`;
      if (hepsi) {
        durum.calisiyor = false;
        const sureKatsayi = durum.seviye === 'hard' ? 3 : durum.seviye === 'medium' ? 2 : 1;
        const bonus = Math.max(0, 200 * sureKatsayi - durum.sure);
        guncelleSkor(bonus);
        durum.ses.bip('ok', 0.15, 0.3);
        toast('Tebrikler! Zaman bonusu: +' + bonus);
        // En iyi skor
        if (durum.skor > (durum.enIyi[durum.seviye] || 0)) {
          durum.enIyi[durum.seviye] = durum.skor;
          storage.set('solar:best', durum.enIyi);
          guncelleEnIyi();
        }
      } else if (!otomatik) {
        toast('Kontrol edildi: ' + dogru + '/8 doğru');
      }
    }

    // İpucu: boş bir slotu doğru gezegen ile vurgula
    let ipucuHak = 3;
    function ipucu() {
      if (durum.seviye === 'hard' && ipucuHak <= 0) { toast('İpucu hakkı bitti'); return; }
      for (let i = 0; i < 8; i++) {
        const slot = $(`.slot[data-index="${i}"]`);
        if (!durum.yerlestirme[i]) {
          const id = GEZEGENLER[i].id;
          const el = $(`#poolList .planet[data-id="${id}"]`);
          if (el) {
            slot.classList.add('accept');
            setTimeout(() => slot.classList.remove('accept'), 700);
            if (durum.seviye === 'hard') ipucuHak--;
            toast('İpucu: doğru slota ışık yandı');
            break;
          }
        }
      }
    }

    // Başlat / yeniden başlat
    function baslat() {
      // Splash gizle
      setTimeout(() => $('#splash').classList.add('hide'), 200);
      // Durum sıfırla
      durum.skor = 0; durum.hamle = 0; durum.sure = 0; durum.combo = 0; ipucuHak = 3;
      $('#score').textContent = '0'; $('#moves').textContent = '0'; $('#time').textContent = '00:00';
      guncelleEnIyi();
      durum.baslamaZamani = performance.now(); durum.calisiyor = true;
      cancelAnimationFrame(rafId); rafId = requestAnimationFrame(zamanDongusu);
      seviyeAyarla(durum.seviye);
    }

    function duraklatDevam() {
      if (durum.calisiyor) {
        durum.calisiyor = false;
        $('#btn-pause').textContent = '▶️ Devam';
      } else {
        durum.calisiyor = true;
        // zamanı sıfırlama: baslamaZamani kaydır
        durum.baslamaZamani = performance.now() - durum.sure * 1000;
        $('#btn-pause').textContent = '⏸️ Duraklat';
      }
    }

    // Tam ekran
    async function tamEkran() {
      try {
        if (!document.fullscreenElement) {
          await document.documentElement.requestFullscreen();
        } else {
          await document.exitFullscreen();
        }
      } catch {}
    }

    // Event listeners
    function baglaKontroller() {
      $('#level').value = durum.seviye;
      $('#level').addEventListener('change', (e) => { seviyeAyarla(e.target.value); baslat(); });
      $('#btn-sound').addEventListener('click', () => {
        durum.ses.toggle();
        const acik = durum.ses.enabled;
        $('#btn-sound').textContent = acik ? '🔊 Ses' : '🔇 Sessiz';
      });
      $('#btn-pause').addEventListener('click', () => duraklatDevam());
      $('#btn-restart').addEventListener('click', () => baslat());
      $('#btn-full').addEventListener('click', () => tamEkran());
      $('#btn-check').addEventListener('click', () => kontrolEt(false));
      $('#btn-hint').addEventListener('click', () => ipucu());
      $('#modalClose').addEventListener('click', () => modalKapat());
      $('#modal').addEventListener('click', (e) => { if (e.target.id === 'modal') modalKapat(); });
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') modalKapat();
        if (e.key === ' ' && !e.repeat) { e.preventDefault(); duraklatDevam(); }
      });
    }

    // Başlat
    window.addEventListener('load', () => {
      baglaKontroller();
      baslat();
    });
  </script>
</body>
</html>